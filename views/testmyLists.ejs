<!doctype html>
<html ng-app="scotchTodo" lang="en">

<head X-Content-Type-Options: nosniff>

    <!-- SPELLS -->
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.16/angular.min.js"></script><!-- load angular -->
    <!-- script src="//ajax.googleapis.com/ajax/libs/angularjs/1.7.8/angular.min.js"></script -->
    <!-- load angular -->
    <!-- ??? Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <!-- ??? Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-filter/0.5.8/angular-filter.min.js"></script>

    <!-- script>import { PaginationModule } from 'ngx-pagination-bootstrap'</script -->

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <base href="/" />

    <script>
        var app = angular.module('myListsController', [])
            .controller('mainController', ['$scope', '$http', 'myLists',  '$filter', function ($scope, $http, myLists, $filter) {
                console.log("myLists.ejs: myListsController mainController reached");
                $scope.formData = {};
                $scope.formItemData = {};
                $scope.loading = true;
                $scope.myListsTableParams = {};
                $scope.myRankedLists = [];
                $scope.myGrps = [];
                $scope.myGrpsA = [];
                $scope.myGrpsB = [];
                $scope.myPublicGrps = [];
                $scope.maxNumListsPerUser = 10;
                $scope.maxNumItemsInList = 25;
                console.log("C");
                $scope.myRankingDone = false;
                $scope.myItemNameTaken = false;
                var userEmail = "<%= user.local.email %>";
                $("#listnametaken").hide();
                //$("#itemnametaken").hide();
                $("#myItemsTable").hide();
                $("#addItemForm").hide();
                $("#addListForm").hide();

                $scope.currentPage = 0;
                $scope.currentPage2 = 0;
                $scope.pageSize = 10;
                $scope.pageSize2 = 10;
                //$scope.data = [];
                $scope.q = '';
                $scope.q2 = '';
                $scope.myLists = [];
                $scope.myItems = [];

                // GET =====================================================================
                myLists.get(userEmail)
                    .success(function (data) {
                        console.log("myLists.ejs: mainController myLists.get success");
                        $scope.myLists = data;
                        $scope.loading = false;
                        $("#listnametaken").hide();
                        //$("#itemnametaken").hide();
                        $("#myItemsTable").hide();
                        $("#addItemForm").hide();
                        $("#addListForm").hide();

                        ////$scope.list = $scope.$parent.personList
                        //$scope.list = $scope.myLists;
                        //$scope.config = {
                        //  itemsPerPage: 5,
                        //  fillLastPage: true
                        //};
                    });
            }]);
    </script>

    <script>
        angular.module('myListsService', [])
            .factory('myLists', ['$http', function ($http) {
                return {
                    get: function (owner) {
                        console.log("myLists.ejs: service myLists get");
                        //return $http.get('/api/myLists');
                        return $http.get('/api/myListsOwner/' + owner);
                    },
                    create: function (Data) {
                        console.log("myLists.ejs: service myLists create");
                        return $http.post('/api/myLists', Data);
                    },
                    delete: function (id) {
                        console.log("myLists.ejs: service myLists delete");
                        return $http.delete('/api/myLists/' + id);
                    },
                    delMyList: function (Data) {
                        console.log("myLists.ejs: service myLists delMyList");
                        return $http.post('/api/delMyList', Data);
                    },
                    change: function (id) {
                        console.log("myLists.ejs: service myLists change");
                        return $http.get('/api/myLists/' + id);
                    },
                    getItems: function (listName) {
                        console.log("myLists.ejs: service myLists getItems");
                        return $http.get('/api/myItems/' + listName);
                    },
                    createItem: function (Data) {
                        console.log("myLists.ejs: service myLists createItem");
                        return $http.post('/api/myItems', Data);
                    },
                    deleteItem: function (Data) {
                        console.log("myLists.ejs: service myLists deleteItem");
                        return $http.post('/api/myItemsRemove', Data); // + {"listName" : listName, "id" : id});
                    },
                    getAllGrps: function () {
                        console.log("myAdminLists.ejs: service myLists getAllGrps");
                        return $http.get('/api/getAllMyGrps');
                    },
                    getAllPublicGrps: function () {
                        console.log("myAdminLists.ejs: service myLists getAllPublicGrps");
                        return $http.get('/api/getAllPublicGrps');
                    },
                    rankItems: function (Data) {
                        console.log("myAdminListsRank.ejs: service myLists rankItems");
                        return $http.post('/api/myItemsRank', Data);
                    },
                    rankItemsRemove: function (Data) {
                        console.log("myAdminListsRank.ejs: service myLists rankItemsRemove");
                        return $http.post('/api/myItemsRankRemove', Data);
                    },
                    rankItemsGet: function (Data) {
                        console.log("myAdminListsRank.ejs: service myLists rankItemsGet");
                        return $http.post('/api/myItemsRankGet', Data);
                    }
                };
            }]);
    </script>

    <script>
        angular.module('scotchTodo', ['myListsController', 'myListsService', 'angular.filter']); //, 'ngMaterial']);
        //angular.module('scotchTodo', ['myListsController', 'myListsService', 'angular.filter','ngMaterial']);
    </script>
    <title>Top 10 Lists</title>
    <!-- link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" / -->
    <!-- link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" / -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <style>
        body {
            padding-top: 0px;
            word-wrap: break-word;
        }
    </style>
</head>

<body class="bg-secondary text-white">
    <div id='mainx' class="container-fluid">
        <% include myNavBar %>
        <div ng-viewx>
            <div ng-controller="mainController">
                <div class="container">
                    <table>
                        <tr>
                            <td>
                                <div ng-view id=myListsTable>
                                    <h3><span class="fa "></span> My Lists ({{ myLists.length }})
                                        <!-- span ng-if="moreListsAllowed()">
                                            <button type="submit" class="btn btn-primary btn-sm"
                                                ng-click="showNewListForm()">New List</button>
                                        </span>
                                        <span ng-if="!moreListsAllowed()">
                                            <p> Maximum number of Lists allowed reached. </p>
                                        </span -->
                                    </h3>
                                    <div id="myLists-listx">
                                        <!-- div class="col-sm-4 col-sm-offset-4" -->
                                        <div>
                                            <table ng-table="myListsTableParams" border="1" cellspacing="0"
                                                cellpadding="4">
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Description</th>
                                                    <th>Owner</th>
                                                    <th>Private</th>
                                                    <th>View Grp</th>
                                                    <th>Edit Grp</th>
                                                    <th>Rank Grp</th>
                                                    <!-- th>Suggestion</th -->
                                                    <!-- th>Vote</th -->
                                                    <th>Items</th>
                                                </tr>
                                                <!-- tbody class="problemcheckboxx" ng-repeat="aList in myLists | orderBy: 'name'
                                                | filter:q | startFrom:currentPage*pageSize | limitTo:pageSize" -->
                                        <tbody class="problemcheckboxx" ng-repeat="aList in myLists | orderBy: 'name' ">
                                                    <td>{{ aList.name }}</td>
                                                    <td>{{ aList.description }}</td>
                                                    <td>{{ aList.owner }}</td>
                                                    <td>{{ aList.private }}</td>
                                                    <td>{{ aList.view }}</td>
                                                    <td>{{ aList.edit }}</td>
                                                    <td>{{ aList.rank }}</td>
                                                    <!-- td>{{ aList.suggestion }}</td -->
                                                    <!-- td>{{ aList.vote }}</td -->
                                                    <!-- td>
                                                        <button type="submit" class="btn btn-primary btn-sm"
                                                        ng-click="itemsOfList2(aList.name, aList.edit, aList.owner)">Items</button>
                                                        <span ng-if="aList.itemCnt == '0' ">
                                                        <span ng-if="inMyGroups(aList.edit) || isMyOwner(aList.owner)">
                                                            <button type="submit" class="btn btn-primary btn-sm"
                                                            ng-click="deleteMyList(aList._id)">Delete</button>
                                                        </span>
                                                        </span>
                                                        <span ng-if="inMyGroups(aList.rank) || isMyOwner(aList.owner)">
                                                        <span ng-if="!myRankedLists.includes(aList.name)">
                                                            <button type="submit" class="btn btn-primary btn-sm"
                                                            ng-click="itemsOfListRank(aList.name)">Rank</button>
                                                        </span>
                                                        <span ng-if="myRankedLists.includes(aList.name)">
                                                            <button type="submit" class="btn btn-primary btn-sm"
                                                            ng-click="RemoveMyRankings(aList.name)">Remove My Rank </button>
                                                        </span>
                                                        </span>
                                                    </td -->
                                                </tbody>
                                                <p class="text-center" ng-show="loading">
                                                    <span class="fa fa-spinner fa-spin fa-3x"></span>
                                                </p>
                                            </table>
                                        </div>
                                    </div>
                                    <!-- /td -->
                                    
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>